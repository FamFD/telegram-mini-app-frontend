<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPChanger - Tukar Crypto ke Rupiah</title>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        :root {
            --primary: #6c42f5;
            --primary-dark: #5935d4;
            --secondary: #2bd2ff;
            --secondary-dark: #23b0d9;
            --dark: #1a1b2f;
            --darker: #121324;
            --light: #f5f5f7;
            --gray: #8a8aa0;
            --success: #00c896;
            --warning: #ff9f43;
            --danger: #ff5e7d;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--darker);
            color: var(--light);
            line-height: 1.6;
            padding-bottom: 80px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: var(--dark);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            padding: 5px;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .wallet-connect {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .wallet-connect:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(107, 66, 245, 0.4);
        }

        /* Hero Section */
        .hero {
            padding: 40px 0;
            text-align: center;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%236c42f5" fill-opacity="0.1" d="M0,128L48,117.3C96,107,192,85,288,112C384,139,480,213,576,224C672,235,768,181,864,165.3C960,149,1056,171,1152,176C1248,181,1344,171,1392,165.3L1440,160L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path></svg>') no-repeat top;
            background-size: contain;
        }

        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.1rem;
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto 30px;
        }

        /* Stats Section */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .stat-card {
            background: var(--dark);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: var(--gray);
        }

        /* Features Section */
        .features {
            margin: 60px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .feature-card {
            background: var(--dark);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card i {
            font-size: 2rem;
            margin-bottom: 15px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-card h3 {
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .feature-card p {
            color: var(--gray);
        }

        /* Payment Section */
        .payment {
            background: var(--dark);
            border-radius: 16px;
            padding: 30px;
            margin: 60px 0;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .payment h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .payment-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray);
        }

        .form-group input, .form-group select {
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: var(--darker);
            color: var(--light);
            font-size: 1rem;
        }

        .input-currency {
            position: absolute;
            right: 15px;
            top: 43px;
            color: var(--gray);
            font-weight: 600;
        }

        .conversion-result {
            background: rgba(107, 66, 245, 0.1);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin: 10px 0;
        }

        .conversion-result p {
            margin: 5px 0;
        }

        .conversion-rate {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .pay-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .pay-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(107, 66, 245, 0.4);
        }
        
        /* Footer */
        footer {
            background: var(--dark);
            padding: 30px 0;
            text-align: center;
            margin-top: 60px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .social-links {
            display: flex;
            gap: 15px;
        }

        .social-links a {
            color: var(--gray);
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }

        .social-links a:hover {
            color: var(--secondary);
        }

        .footer-links {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .footer-links a {
            color: var(--gray);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: var(--primary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .input-currency {
                top: 43px;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="container">
        <div class="header-content">
            <div class="logo">
                <img
                    src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='50' fill='%236c42f5' /><path d='M30 30 L70 30 L70 70 L30 70 Z' fill='none' stroke='white' stroke-width='8' /></svg>"
                    alt="Hachanger Logo"
                />
                <h1>RPChanger</h1>
            </div>
            <button class="wallet-connect">
                <i class="fas fa-wallet"></i> Connect Wallet
            </button>
        </div>
    </div>
</header>

<main class="container">
    <section class="hero">
        <h2>RPchanger</h2>
        <p>
            Tukar Aset Digital Anda Ke IDR dengan Mudah dan Aman 
        </p>
    </section>

    <section class="stats">
        <div class="stat-card">
            <i class="fas fa-exchange-alt"></i>
            <h3>P2P</h3>
            <p>Peer to Peer instan tanpa KYC</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-users"></i>
            <h3>1K+</h3>
            <p>Testimoni Positif</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-shield-alt"></i>
            <h3>100%</h3>
            <p>Jaminan Transaksi Jika Gagal Uang Kembali</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-bolt"></i>
            <h3>&lt; 25min</h3>
            <p>Proses Cepat</p>
        </div>
    </section>

    <section class="payment">
        <h2 class="section-title">Tukar Aset Digital Sekarang</h2>
        <div class="payment-form">
            <div class="form-group">
                <label for="amount">Jumlah Rupiah yang Anda Inginkan</label>
                <input type="number" id="amount" placeholder="Masukkan jumlah Rupiah" min="10000" step="1000">
                <span class="input-currency">IDR</span>
            </div>
            
            <div class="conversion-result">
                <p>Estimasi Crypto: <span id="crypto-amount">0</span> <span id="crypto-type">USDT</span></p>
                <p class="conversion-rate">1 USDT = Rp 15,500</p>
            </div>
            
            <div class="form-group">
                <label for="crypto">Pilih Aset Digital</label>
                <select id="crypto">
                    <option value="usdt" selected>Tether (USDT)</option>
                    <option value="btc">Bitcoin (BTC)</option>
                    <option value="eth">Ethereum (ETH)</option>
                    <option value="bnb">BNB (BNB)</option>
                    <option value="xrp">Ripple (XRP)</option>
                    <option value="ton">TON (TON)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="bank">Pilih Bank Penerima</label>
                <select id="bank">
                    <option value="" disabled selected>Pilih metode pembayaran</option>
                    <option value="bca">BCA</option>
                    <option value="bri">BRI</option>
                    <option value="mandiri">Mandiri</option>
                    <option value="bni">BNI</option>
                    <option value="jenius">Jenius</option>
                    <option value="ovo">OVO</option>
                    <option value="dana">DANA</option>
                    <option value="gopay">GoPay</option>
                    <option value="shopeepay">ShopeePay</option>
                    <option value="linkaja">LinkAja</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="account-number">Nomor Rekening/E-Wallet</label>
                <input type="text" id="account-number" placeholder="Masukkan nomor rekening atau e-wallet">
            </div>
            
            <div class="form-group">
                <label for="account-name">Nama Pemilik Rekening</label>
                <input type="text" id="account-name" placeholder="Masukkan nama pemilik rekening">
            </div>
            <div>
            <button class="pay-btn">
                <i class="fas fa-wallet"></i> Bayar Sekarang
            </button>
            </div>
    </section>

    <section class="features">
        <h2 class="section-title">Pelayanan Kami</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <i class="fas fa-coins"></i>
                <h3>Semi Instant Payment</h3>
                <p>
                    Kami berusaha untuk secepat mungkin memproses pesanan anda dalam waktu 2-20 menit, Kecuali kondisi yang overload biasa nya membutuhkan waktu 20-45 menit.
                </p>
            </div>
            <div class="feature-card">
                <i class="fas fa-user-shield"></i>
                <h3>Komitmen</h3>
                <p>
                    kami senantiasa menjaga kepercayaan pelanggan dengan memberi jaminan uang kembali jika transaksi anda gagal.
                </p>
            </div>
            
            <div class="feature-card">
                <i class="fas fa-percentage"></i>
                <h3>Minimum Order</h3>
                <p>
                    Kami mengerti begitu sulit nya mencari Exchanger untuk memesan dengan jumlah kecil, Untuk itu kami memberikan solusi Minimal transaksi dengan jumlah kecil mulai dari 2 USD.
                </p>
            </div>
            <div class="feature-card">
                <i class="fas fa-bank"></i>
                <h3>Pembayaran </h3>
                <p>
                    Banyak pilihan pembayaran yang kami sediakan, mulai dari pembayaran keseluruh Bank dan Dompet Digital yang ada di indonesia.
                </p>
            </div>
        </div>
    </section>
</main>

<footer>
    <div class="container">
        <div class="footer-content">
            <div class="social-links">
                <a href="#"><i class="fab fa-telegram"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-discord"></i></a>
                <a href="#"><i class="fab fa-medium"></i></a>
            </div>
            <div class="footer-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Help Center</a>
                <a href="#">API Documentation</a>
                <a href="#">Contact Us</a>
            </div>
            <p>Â© 2023 RPChanger. All rights reserved.</p>
        </div>
    </div>
</footer>

<script>
        // Initialize Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // Initialize TON Connect
        const tonConnectUI = new TonConnectUI({
            manifestUrl: 'https://famfd.github.io/telegram-mini-app-frontend/tonconnect-manifest.json',
            buttonRootId: '.wallet-connect',
            network: 'testnet' // Gunakan 'mainnet' untuk produksi
        });

        // Crypto conversion rates
        const CRYPTO_RATES = {
            usdt: 15500,
            btc: 950000000,
            eth: 55000000,
            bnb: 8500000,
            xrp: 8500,
            ton: 35000
        };

        // Wallet connection status
        let connectedWallet = null;

        // Wallet connection functionality
        tonConnectUI.onStatusChange(wallet => {
            if (wallet) {
                connectedWallet = wallet;
                document.querySelector('.wallet-connect').innerHTML = `<i class="fas fa-wallet"></i> ${shortenAddress(wallet.account.address)}`;
                tg.showPopup({
                    title: 'Wallet Terhubung',
                    message: `Terhubung ke alamat: ${shortenAddress(wallet.account.address)}`,
                    buttons: [{ type: 'ok' }]
                });
            } else {
                connectedWallet = null;
                document.querySelector('.wallet-connect').innerHTML = `<i class="fas fa-wallet"></i> Connect Wallet`;
                tg.showPopup({
                    title: 'Wallet Terputus',
                    message: 'Koneksi wallet telah terputus.',
                    buttons: [{ type: 'ok' }]
                });
            }
        });

        // Calculate crypto amount when IDR input changes
        document.getElementById('amount').addEventListener('input', function() {
            calculateCryptoAmount();
        });

        // Update calculation when crypto type changes
        document.getElementById('crypto').addEventListener('change', function() {
            calculateCryptoAmount();
            updateCryptoType();
        });

        // Calculate crypto amount based on IDR input
        function calculateCryptoAmount() {
            const idrAmount = parseFloat(document.getElementById('amount').value) || 0;
            const cryptoType = document.getElementById('crypto').value;
            const cryptoAmount = idrAmount / CRYPTO_RATES[cryptoType];
            document.getElementById('crypto-amount').textContent = cryptoAmount.toFixed(6);
            document.querySelector('.conversion-rate').textContent = `1 ${cryptoType.toUpperCase()} = Rp ${formatRupiah(CRYPTO_RATES[cryptoType])}`;
        }

        // Update crypto type display
        function updateCryptoType() {
            const cryptoType = document.getElementById('crypto').value;
            document.getElementById('crypto-type').textContent = cryptoType.toUpperCase();
        }

        // Pay button functionality
        document.querySelector('.pay-btn').addEventListener('click', async function() {
            const idrAmount = document.getElementById('amount').value;
            const cryptoType = document.getElementById('crypto');
            const cryptoText = cryptoType.options[cryptoType.selectedIndex].text;
            const cryptoAmount = parseFloat(document.getElementById('crypto-amount').textContent);
            const bank = document.getElementById('bank');
            const bankText = bank.options[bank.selectedIndex]?.text || '';
            const accountNumber = document.getElementById('account-number').value;
            const accountName = document.getElementById('account-name').value;

            // Validasi form
            if (!idrAmount || idrAmount < 10000) {
                tg.showPopup({
                    title: 'Error',
                    message: 'Nominal minimal adalah Rp 10,000',
                    buttons: [{ type: 'ok' }]
                });
                return;
            }

            if (!bank.value) {
                tg.showPopup({
                    title: 'Error',
                    message: 'Silakan pilih metode pembayaran',
                    buttons: [{ type: 'ok' }]
                });
                return;
            }

            if (!accountNumber) {
                tg.showPopup({
                    title: 'Error',
                    message: 'Silakan masukkan nomor rekening/e-wallet',
                    buttons: [{ type: 'ok' }]
                });
                return;
            }

            if (!accountName) {
                tg.showPopup({
                    title: 'Error',
                    message: 'Silakan masukkan nama pemilik rekening',
                    buttons: [{ type: 'ok' }]
                });
                return;
            }

            if (!connectedWallet) {
                tg.showPopup({
                    title: 'Error',
                    message: 'Silakan hubungkan TON Wallet terlebih dahulu',
                    buttons: [{ type: 'ok' }]
                });
                return;
            }

            if (cryptoType.value !== 'ton') {
                tg.showPopup({
                    title: 'Error',
                    message: 'Saat ini hanya mendukung transaksi dengan TON.',
                    buttons: [{ type: 'ok' }]
                });
                return;
            }

            // Konfirmasi pembayaran
            tg.showPopup({
                title: 'Konfirmasi Penukaran',
                message: `Anda akan menerima Rp ${formatRupiah(idrAmount)} dengan mengirim ${cryptoAmount} ${cryptoText} melalui ${bankText}. Lanjutkan?`,
                buttons: [
                    { id: 'confirm', type: 'default', text: 'Konfirmasi' },
                    { type: 'cancel' }
                ]
            }, async function(buttonId) {
                if (buttonId === 'confirm') {
                    tg.showPopup({
                        title: 'Memproses Pembayaran',
                        message: 'Mohon tunggu sebentar...',
                        buttons: []
                    });

                    try {
                        const response = await fetch('https://telegram-crypto-app-zeta.vercel.app/api/createInvoice', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                amount: idrAmount,
                                cryptoAmount: cryptoAmount,
                                cryptoType: cryptoText,
                                bankDetails: {
                                    bankName: bankText,
                                    accountNumber: accountNumber,
                                    accountName: accountName
                                },
                                walletAddress: connectedWallet.account.address,
                                initData: tg.initData
                            })
                        });

                        const data = await response.json();

                        if (data.transaction) {
                            const transaction = {
                                validUntil: Math.floor(Date.now() / 1000) + 3600,
                                messages: [
                                    {
                                        address: data.transaction.address,
                                        amount: (cryptoAmount * 1e9).toString(),
                                        payload: btoa(JSON.stringify({
                                            description: `Penukaran ${cryptoAmount} TON ke IDR`,
                                            bankDetails: {
                                                bankName: bankText,
                                                accountNumber: accountNumber,
                                                accountName: accountName
                                            }
                                        }))
                                    }
                                ]
                            };

                            const result = await tonConnectUI.sendTransaction(transaction);

                            tg.closePopup();
                            tg.showPopup({
                                title: 'Transaksi Berhasil',
                                message: `Transaksi ${cryptoAmount} TON telah dikirim. Silakan tunggu konfirmasi.`,
                                buttons: [{ type: 'ok' }]
                            });
                        } else {
                            throw new Error('Gagal mendapatkan detail transaksi dari backend.');
                        }
                    } catch (error) {
                        tg.closePopup();
                        tg.showPopup({
                            title: 'Terjadi Kesalahan',
                            message: `Gagal memproses transaksi: ${error.message}`,
                            buttons: [{ type: 'ok' }]
                        });
                        console.error('Error:', error);
                    }
                }
            });
        });

        // Format Rupiah
        function formatRupiah(amount) {
            return new Intl.NumberFormat('id-ID', {
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Shorten wallet address for display
        function shortenAddress(address) {
            return `${address.slice(0, 6)}...${address.slice(-4)}`;
        }

        // Animate elements on scroll
        function animateOnScroll() {
            const elements = document.querySelectorAll('.stat-card, .feature-card');
            elements.forEach(element => {
                const position = element.getBoundingClientRect();
                if (position.top < window.innerHeight - 100) {
                    element.style.opacity = 1;
                    element.style.transform = 'translateY(0)';
                }
            });
        }

        // Initialize animation properties
        document.querySelectorAll('.stat-card, .feature-card').forEach(element => {
            element.style.opacity = 0;
            element.style.transform = 'translateY(20px)';
            element.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateCryptoType();
            window.addEventListener('scroll', animateOnScroll);
            animateOnScroll();

            // Fetch real-time TON price
            async function fetchTONPrice() {
                try {
                    const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=the-open-network&vs_currencies=idr');
                    const data = await response.json();
                    CRYPTO_RATES.ton = data['the-open-network'].idr;
                    calculateCryptoAmount();
                } catch (error) {
                    console.error('Error fetching TON price:', error);
                }
            }
            fetchTONPrice();
        });
    </script>
</body>
</html>
